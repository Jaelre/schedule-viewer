# v1.1.1 · Worker gate & density refresh

## Highlights
- The schedule is now wrapped in a worker-backed password gate that exchanges bearer tokens via `/api/access` and `/api/check-access`, keeps them in `localStorage`, and only renders the app after validation succeeds.
- ScheduleGrid has been refactored into modular static and virtualised renderers with a new ultra-compact density preset, adaptive name column widths, and better behaviour on narrow screens.
- Doctor display names and pseudonyms are parsed separately so pseudonyms render alongside, but not inside, clinician names while the API client automatically attaches the bearer token to worker requests.

## Frontend
### Password gate & shell
- Added a client-only `<PasswordGate>` wrapper that reads any saved `schedule_viewer_token`, verifies it with `/api/check-access`, handles the password form, and persists the returned token before showing the schedule UI.
- Split the home page into a suspense-friendly `ScheduleApp` container so the password gate protects the entire experience while defaulting the density toggle to the compact preset.
- Updated the metadata title to "Turni PS Policlinico" and kept the favicon bundle under `public/icons/` for static export deployments.

### Schedule grid ergonomics
- Replaced the monolithic grid with a directory of components that decide between a static CSS grid and a TanStack Virtual path using a configurable row threshold, both of which respect the extra-compact density profile.
- Name columns now measure the text + pseudonym width, shrink to initials while horizontally scrolling, and keep pseudonyms right-aligned so mobile users retain context even when the grid overflows.
- Shift cells share a dedicated renderer that adapts padding, chip styling, and placeholder typography for each density level.

### Naming & data fetching
- `getDoctorDisplayName` returns structured `name`/`pseudonym` pairs so grid helpers can sort, abbreviate, and hide sentinel entries before rendering.
- The React Query client now injects the saved token as an `Authorization` header when calling the worker’s `/api/shifts` endpoint, aligning the browser with the worker-managed gate.

## Worker
- Introduced `/api/access` and `/api/check-access` endpoints that compare credentials in constant time, mirror the request origin in CORS headers, and return JSON tokens used by the frontend.
- Worker authentication accepts legacy cookies for backwards compatibility but prefers the new bearer token, and CORS preflight responses now allow `Authorization` headers plus credentials.
- Increased the default cache TTL to 900 seconds while keeping hit/miss headers so downstream clients can observe worker caching behaviour.

## Documentation & configuration
- Added `ACCESS_PASSWORD` guidance to `.env.example` and `worker/.dev.vars.example`, explaining how to seed secrets for local and hosted deployments.
- Documented the worker-managed access gate, token contract, and static hosting flow in `docs/access-gate.md` and `docs/deployment-options.md` alongside ADR notes for conditional row virtualisation.
